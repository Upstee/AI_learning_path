# 练习1：完整模型优化系统

## 练习目标

构建一个完整的模型优化系统，包括数据预处理、特征选择、超参数调优、模型评估、结果可视化等全流程。

## 练习要求

### 难度等级
- **挑战** - 解决实际问题，综合运用所有知识
- **代码量**：> 500行
- **时间**：8-12小时

### 任务1：创建模型优化框架

创建一个`ModelOptimizer`类，包含以下功能：

1. **初始化方法**
   ```python
   def __init__(self, X, y, task_type='classification'):
       """
       初始化优化器
       参数:
           X: 特征数据
           y: 标签数据
           task_type: 'classification' 或 'regression'
       """
   ```

2. **数据预处理**
   ```python
   def preprocess_data(self, handle_missing='mean', scale=True):
       """
       数据预处理
       参数:
           handle_missing: 缺失值处理方法 ('mean', 'median', 'mode', 'drop')
           scale: 是否标准化
       返回:
           处理后的数据
       """
   ```

3. **特征选择**
   ```python
   def select_features(self, method='univariate', n_features=None):
       """
       特征选择
       参数:
           method: 选择方法 ('univariate', 'rfe', 'importance')
           n_features: 选择的特征数量
       返回:
           选择的特征索引
       """
   ```

4. **超参数调优**
   ```python
   def tune_hyperparameters(self, model, param_grid, cv=5, scoring=None):
       """
       超参数调优
       参数:
           model: 模型对象
           param_grid: 参数网格
           cv: 交叉验证折数
           scoring: 评估指标
       返回:
           最佳参数和最佳模型
       """
   ```

5. **模型评估**
   ```python
   def evaluate_model(self, model, X_test, y_test):
       """
       评估模型
       返回:
           评估指标字典
       """
   ```

### 任务2：实现完整的优化流程

实现以下完整流程：

1. **数据加载和探索**
   - 加载数据
   - 数据探索（缺失值、异常值、分布）
   - 数据可视化

2. **数据预处理**
   - 处理缺失值
   - 处理异常值
   - 特征标准化/归一化
   - 类别编码（如需要）

3. **特征工程**
   - 特征选择
   - 特征变换
   - 特征组合（可选）

4. **模型选择和调优**
   - 尝试多种模型
   - 对每个模型进行超参数调优
   - 使用交叉验证评估

5. **模型评估和比较**
   - 计算多种评估指标
   - 可视化评估结果
   - 生成评估报告

6. **结果保存和报告**
   - 保存最佳模型
   - 生成优化报告
   - 可视化优化过程

### 任务3：实现高级功能

1. **自动化特征选择**
   - 实现多种特征选择方法
   - 自动选择最佳特征子集
   - 可视化特征重要性

2. **集成学习优化**
   - 实现Bagging和Boosting
   - 超参数调优
   - 模型融合

3. **学习曲线分析**
   - 绘制学习曲线
   - 判断过拟合/欠拟合
   - 提供改进建议

4. **模型解释性**
   - 特征重要性分析
   - SHAP值计算（可选）
   - 模型决策可视化

## 实现提示

### 1. 数据准备
```python
from sklearn.datasets import make_classification, make_regression
from sklearn.model_selection import train_test_split

# 生成数据
X, y = make_classification(n_samples=1000, n_features=20, 
                          n_informative=10, random_state=42)
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)
```

### 2. 特征选择方法
```python
from sklearn.feature_selection import (
    SelectKBest, f_classif, RFE, SelectFromModel
)
from sklearn.ensemble import RandomForestClassifier

# 单变量特征选择
selector = SelectKBest(f_classif, k=10)

# 递归特征消除
rfe = RFE(RandomForestClassifier(), n_features_to_select=10)

# 基于重要性的特征选择
rf = RandomForestClassifier()
rf.fit(X_train, y_train)
selector = SelectFromModel(rf, threshold='median')
```

### 3. 超参数调优
```python
from sklearn.model_selection import GridSearchCV, RandomizedSearchCV
from sklearn.ensemble import RandomForestClassifier

# 参数网格
param_grid = {
    'n_estimators': [50, 100, 200],
    'max_depth': [3, 5, 7, None],
    'min_samples_split': [2, 5, 10]
}

# 网格搜索
grid_search = GridSearchCV(
    RandomForestClassifier(),
    param_grid,
    cv=5,
    scoring='f1',
    n_jobs=-1
)
grid_search.fit(X_train, y_train)
```

### 4. 模型评估
```python
from sklearn.metrics import (
    accuracy_score, precision_score, recall_score, f1_score,
    roc_auc_score, confusion_matrix, classification_report
)

# 评估指标
metrics = {
    'accuracy': accuracy_score(y_test, y_pred),
    'precision': precision_score(y_test, y_pred),
    'recall': recall_score(y_test, y_pred),
    'f1': f1_score(y_test, y_pred),
    'roc_auc': roc_auc_score(y_test, y_pred_proba)
}
```

### 5. 可视化
```python
import matplotlib.pyplot as plt
import seaborn as sns

# 混淆矩阵
cm = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues')

# ROC曲线
from sklearn.metrics import roc_curve
fpr, tpr, _ = roc_curve(y_test, y_pred_proba)
plt.plot(fpr, tpr, label='ROC curve')
```

## 评估标准

### 功能完整性（40分）
- [ ] 数据预处理完整（10分）
- [ ] 特征选择实现（10分）
- [ ] 超参数调优实现（10分）
- [ ] 模型评估完整（10分）

### 代码质量（30分）
- [ ] 代码结构清晰，模块化设计（10分）
- [ ] 注释详细，易于理解（10分）
- [ ] 错误处理完善（10分）

### 结果质量（30分）
- [ ] 评估指标计算正确（10分）
- [ ] 可视化清晰美观（10分）
- [ ] 优化效果明显（10分）

## 扩展任务（加分项）

1. **实现自动化机器学习（AutoML）**
   - 自动选择最佳模型
   - 自动特征工程
   - 自动超参数调优

2. **实现模型解释性分析**
   - SHAP值计算
   - LIME解释
   - 特征重要性可视化

3. **实现模型部署功能**
   - 模型保存和加载
   - API接口设计
   - 批量预测功能

## 参考实现

可以参考以下思路：

1. 使用Pipeline整合所有步骤
2. 使用GridSearchCV或RandomizedSearchCV进行超参数调优
3. 使用交叉验证评估模型性能
4. 使用matplotlib和seaborn进行可视化
5. 使用joblib保存和加载模型

## 提交要求

1. 完整的Python代码文件
2. 运行结果截图
3. 优化报告（Markdown格式）
4. 代码说明文档

## 学习目标

完成本练习后，你应该能够：
- 独立完成完整的模型优化流程
- 理解特征选择和超参数调优的重要性
- 掌握模型评估和比较的方法
- 能够生成专业的优化报告

