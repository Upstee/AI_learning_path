# 练习3：交叉验证实战

## 练习目标

掌握使用交叉验证评估模型性能，理解不同交叉验证方法的适用场景。

## 练习要求

### 任务1：K折交叉验证

1. **从零实现K折交叉验证**
   - 实现一个函数`k_fold_cross_validation`，不使用scikit-learn的`cross_val_score`
   - 函数应该能够：
     - 将数据集划分为K折
     - 对每一折进行训练和评估
     - 返回每折的评估结果和平均结果

2. **使用scikit-learn的K折交叉验证**
   - 使用`cross_val_score`进行K折交叉验证
   - 使用`KFold`自定义折数
   - 使用`StratifiedKFold`进行分层K折交叉验证（用于分类）

3. **比较不同K值的影响**
   - 测试K=3, 5, 10, 20时的交叉验证结果
   - 分析K值对评估结果的影响

### 任务2：留一法交叉验证

1. **实现留一法交叉验证**
   - 使用`LeaveOneOut`进行留一法交叉验证
   - 比较留一法与K折交叉验证的结果

2. **分析留一法的优缺点**
   - 计算时间对比
   - 评估结果对比
   - 适用场景分析

### 任务3：分层交叉验证

1. **实现分层交叉验证**
   - 使用`StratifiedKFold`进行分层交叉验证
   - 比较普通K折和分层K折的结果差异

2. **分析分层交叉验证的重要性**
   - 在类别不平衡数据集上的表现
   - 为什么分层交叉验证更适合分类任务

### 任务4：时间序列交叉验证

1. **实现时间序列交叉验证**
   - 使用`TimeSeriesSplit`进行时间序列交叉验证
   - 理解时间序列数据的特点

## 代码框架

```python
import numpy as np
from sklearn.datasets import load_iris, load_diabetes
from sklearn.model_selection import (
    cross_val_score, KFold, StratifiedKFold,
    LeaveOneOut, TimeSeriesSplit
)
from sklearn.linear_model import LogisticRegression, LinearRegression
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import accuracy_score, mean_squared_error

# TODO: 从零实现K折交叉验证
def k_fold_cross_validation(X, y, model, k=5, scoring='accuracy'):
    """
    从零实现K折交叉验证
    参数:
        X: 特征数据
        y: 标签数据
        model: 模型对象
        k: 折数
        scoring: 评估指标
    返回:
        scores: 每折的评估结果
        mean_score: 平均评估结果
    """
    pass

# TODO: 使用scikit-learn的K折交叉验证
# TODO: 比较不同K值的影响
# TODO: 实现留一法交叉验证
# TODO: 实现分层交叉验证
# TODO: 实现时间序列交叉验证
```

## 输出要求

1. **K折交叉验证结果**：
   - 不同K值下的交叉验证结果表格
   - K值对评估结果影响的图表
   - 从零实现与scikit-learn实现的对比

2. **留一法交叉验证结果**：
   - 留一法与K折交叉验证的对比表格
   - 计算时间对比
   - 适用场景分析

3. **分层交叉验证结果**：
   - 普通K折与分层K折的对比
   - 在类别不平衡数据集上的表现分析

4. **综合分析报告**：
   - 不同交叉验证方法的优缺点
   - 如何选择合适的交叉验证方法
   - 实际应用建议

## 测试数据集

1. **分类数据集**：`load_iris`（平衡数据集）
2. **分类数据集**：自定义不平衡数据集
3. **回归数据集**：`load_diabetes`
4. **时间序列数据**：生成模拟时间序列数据

## 提示

1. **K折交叉验证**：
   - K值越大，评估结果越稳定，但计算时间越长
   - 通常K=5或K=10是较好的选择

2. **留一法交叉验证**：
   - 计算成本高，但能充分利用数据
   - 适合小数据集

3. **分层交叉验证**：
   - 确保每一折中各类别的比例与原始数据集相同
   - 对分类任务很重要，特别是类别不平衡时

4. **时间序列交叉验证**：
   - 保持时间顺序，避免未来信息泄露
   - 适合时间序列预测任务

## 思考题

1. 为什么K折交叉验证比单次训练-测试划分更可靠？
2. 在什么情况下应该使用留一法交叉验证？
3. 为什么分层交叉验证对分类任务很重要？
4. 如何选择K值？K值越大越好吗？
5. 时间序列数据为什么不能使用普通的K折交叉验证？

## 难度等级

**基础** - 需要理解交叉验证的原理和不同方法的适用场景

## 预计时间

3-4小时

